<!--
Version:1.0.0
Author:lxj
Date:2020/03/17
復電工單辦理
-->
<ons-page ng-controller="cemfdblCtrl">
    <ons-modal var="app.fdblModal" class="tf-loader-modal">
        <div class="hy-layout-column hy-layout-align-center-center">
            <div class="tf-loader-content hy-layout-row hy-layout-align-start-center">
                <hy-progress-circular hy-mode="indecterminate"></hy-progress-circular>
                <div class="tf-loader-content-text">加載中...</div>
            </div>
        </div>
    </ons-modal>
    <ons-toolbar class="cem_topbar">
        <div class="left">
            <hy-back-button></hy-back-button>
        </div>
        <div class="center">
            復電工單辦理
        </div>
        <div class="right cem_title">
            <div>
                <img ng-src="img/cem/db/filter_check.png" style="display: none;"/>
            </div>
            <div ng-click="changeLanguage(flag)">
                <img ng-src="{{ languageSrc }}"/>
            </div>
        </div>
    </ons-toolbar>
    <div style="height: 100%;overflow: hidden" class="hy-layout-column">
        <div class="nwyyt_jf_content1" style="z-index: 99;flex: none;margin: 0;box-shadow: 0 2px 1px -2px #eeeeee">
            <div class="content_inner">
                <div layout="row" layout-align="center center">
                    <div layout="row" layout-align="center center" style="width:50% ">
                        <div class="up_button" ng-class="{active:integral(0)}" ng-click="selectSortType(0)">復電信息
                        </div>
                    </div>
                    <div layout="row" layout-align="center center" style="width:50%">
                        <div class="up_button " ng-class="{active:integral(1)}" ng-click="selectSortType(1)">鎖信息
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!--內容展示-->
        <div style="overflow: scroll" class="hy-focus-scroll-content" ng-if="SortType===0">
            <!--基本信息-->
            <div style="width: 100%;margin-bottom: 20px">
                <div class="cemydyz_xcjcbl_head">
                    <div class="cemydyz_xcjcbl_head_icon">
                    </div>
                    <div class="cemydyz_xcjcbl_head_title">
                        基本信息
                    </div>
                </div>
                <div class="cemydyz_xcjcbl_content">
                    <div class="hy-layout-row">
                        <div class="hy-layout-row cemydzy-xcjc-form-row-header hy-layout-align-end-center">工作單號
                        </div>
                        <div class="hy-layout-row cemydzy-xcjc-form-row-content cemydzy-border-bottom">
                            {{jbxx.rcnntordrno}}
                        </div>
                    </div>
                    <div class="hy-layout-row">
                        <div class="hy-layout-row cemydzy-xcjc-form-row-header hy-layout-align-end-center">復電類型
                        </div>
                        <div class="hy-layout-row cemydzy-xcjc-form-row-content cemydzy-border-bottom">
                            {{jbxx.rcnntordrtypcdMc}}
                        </div>
                    </div>
                    <div class="hy-layout-row">
                        <div class="hy-layout-row cemydzy-xcjc-form-row-header hy-layout-align-end-center">電錶號</div>
                        <div class="hy-layout-row cemydzy-xcjc-form-row-content cemydzy-border-bottom">
                            {{jbxx.mtrasseno}}
                        </div>
                    </div>
                    <div class="hy-layout-row">
                        <div class="hy-layout-row cemydzy-xcjc-form-row-header hy-layout-align-end-center">合約賬戶
                        </div>
                        <div class="hy-layout-row cemydzy-xcjc-form-row-content cemydzy-border-bottom">
                            {{jbxx.cntracctno}}
                        </div>
                    </div>
                    <div class="hy-layout-row">
                        <div class="hy-layout-row cemydzy-xcjc-form-row-header hy-layout-align-end-center">客戶姓名
                        </div>
                        <div class="hy-layout-row cemydzy-xcjc-form-row-content cemydzy-border-bottom">
                            {{ !flag?jbxx.custnm:jbxx.custenglnm }}
                        </div>
                    </div>
                    <div class="hy-layout-row">
                        <div class="hy-layout-row cemydzy-xcjc-form-row-header hy-layout-align-end-center">客戶電話
                        </div>
                        <div class="hy-layout-row cemydzy-xcjc-form-row-content cemydzy-border-bottom">
                            {{jbxx.ctctaddr}}
                        </div>
                    </div>
                    <div class="hy-layout-row">
                        <div class="hy-layout-row cemydzy-xcjc-form-row-header hy-layout-align-end-center">用戶地址
                        </div>
                        <div class="hy-layout-row cemydzy-xcjc-form-row-content cemydzy-border-bottom">
                            {{ !flag?jbxx.custaddr:jbxx.detaengladdr }}
                        </div>
                    </div>
                    <div class="hy-layout-row">
                        <div class="hy-layout-row cemydzy-xcjc-form-row-header hy-layout-align-end-center">設備GPS
                        </div>
                        <div class="hy-layout-row cemydzy-xcjc-form-row-content cemydzy-border-bottom"
                             style="margin-right: 0">
                            {{ jbxx.equilocdescr}}
                        </div>
                        <div class="cem-input-scancodes cemydzy-border-bottom" ng-click="openMap('equipment')"
                             style="margin-right: 20px">
                            <img src="img/cem/cbbl/dingwei.png"/>
                        </div>
                    </div>
                    <div class="hy-layout-row">
                        <div class="hy-layout-row cemydzy-xcjc-form-row-header hy-layout-align-end-center">訂定功率
                        </div>
                        <div class="hy-layout-row cemydzy-xcjc-form-row-content cemydzy-border-bottom">
                            {{jbxx.sqsubsdemaMc ?jbxx.sqsubsdemaMc :jbxx.sqsubsdema}}
                        </div>
                    </div>
                    <div class="hy-layout-row">
                        <div class="hy-layout-row cemydzy-xcjc-form-row-header hy-layout-align-end-center">申請功率
                        </div>
                        <div class="hy-layout-row cemydzy-xcjc-form-row-content cemydzy-border-bottom">
                            {{jbxx.sqsubsdemaMc ?jbxx.sqsubsdemaMc :jbxx.sqsubsdema}}
                        </div>
                    </div>
                    <div class="hy-layout-row">
                        <div class="hy-layout-row cemydzy-xcjc-form-row-header hy-layout-align-end-center cem-line-height">
                            供電點信息
                        </div>
                        <div class="hy-layout-row cemydzy-xcjc-form-row-content cemydzy-border-bottom margin-left-zero">
                            {{ jbxx.supppntno }}<!--供电点编号：{{ jbxx.supppntno }};供电点类型:{{jbxx.supppnttyp}}-->
                        </div>
                        <div class="cem-input-scancodes cemydzy-border-bottom" ng-click="openMap()"
                             style="margin-right: 20px">
                            <img src="img/cem/cbbl/dingwei.png"/>
                        </div>
                    </div>
                    <div class="hy-layout-row">
                        <div class="hy-layout-row cemydzy-xcjc-form-row-header hy-layout-align-end-center">創建時間
                        </div>
                        <div class="hy-layout-row cemydzy-xcjc-form-row-content cemydzy-border-bottom">
                            {{ jbxx.cretm }}
                        </div>
                    </div>
                    <div class="hy-layout-row">
                        <div class="hy-layout-row cemydzy-xcjc-form-row-header hy-layout-align-end-center">停電方式
                        </div>
                        <div class="hy-layout-row cemydzy-xcjc-form-row-content cemydzy-border-bottom">
                            {{ jbxx.disconmethcdMc ?jbxx.disconmethcdMc:jbxx.disconmethcd }}
                        </div>
                    </div>
                    <div class="hy-layout-row">
                        <div class="hy-layout-row cemydzy-xcjc-form-row-header hy-layout-align-end-center cem-line-height">
                            斷路器類型
                        </div>
                        <div class="hy-layout-row cemydzy-xcjc-form-row-content cemydzy-border-bottom">
                            {{ jbxx.mcbtypMc?jbxx.mcbtypMc:jbxx.mcbtyp }}
                        </div>
                    </div>

                    <div class="hy-layout-row">
                        <div class="hy-layout-row cemydzy-xcjc-form-row-header hy-layout-align-end-center cem-line-height">
                            斷路器安裝位置
                        </div>
                        <div class="hy-layout-row cemydzy-xcjc-form-row-content cemydzy-border-bottom">
                            {{ jbxx.mcbinstlocMc?jbxx.mcbinstlocMc:jbxx.mcbinstloc }}
                        </div>
                    </div>
                    <div class="hy-layout-row">
                        <div class="hy-layout-row cemydzy-xcjc-form-row-header hy-layout-align-end-center cem-line-height">
                            斷路器電流
                        </div>
                        <div class="hy-layout-row cemydzy-xcjc-form-row-content cemydzy-border-bottom">
                            {{ jbxx.mcbcurMc?jbxx.mcbcurMc:jbxx.mcbcur }}A
                        </div>
                    </div>
                    <div class="hy-layout-row">
                        <div class="hy-layout-row cemydzy-xcjc-form-row-header hy-layout-align-end-center">數量
                        </div>
                        <div class="hy-layout-row cemydzy-xcjc-form-row-content cemydzy-border-bottom">
                            {{ jbxx.mcbnbr }}
                        </div>
                    </div>
                    <div class="hy-layout-row">
                        <div class="hy-layout-row cemydzy-xcjc-form-row-header hy-layout-align-end-center">聯繫方式
                        </div>
                        <div class="hy-layout-row cemydzy-xcjc-form-row-content cemydzy-border-bottom">
                            {{ jbxx.rcnntctnttele }}
                        </div>
                    </div>
                    <div class="hy-layout-row">
                        <div class="hy-layout-row cemydzy-xcjc-form-row-header hy-layout-align-end-center cem-line-height">
                            復電剩餘時間
                        </div>
                        <div class="hy-layout-row cemydzy-xcjc-form-row-content cemydzy-border-bottom">
                            {{ jbxx.rmdminuteTm }}
                        </div>
                    </div>
                    <div class="hy-layout-row">
                        <div class="hy-layout-row cemydzy-xcjc-form-row-header hy-layout-align-end-center">備注
                        </div>
                        <div class="hy-layout-row cemydzy-xcjc-form-row-content cemydzy-border-bottom"
                             ng-click="showRemark()">
                            {{ jbxx.rcnntrmk }}
                        </div>
                    </div>
                </div>
            </div>
            <!--上次停電相關圖片-->
            <div style="width: 100%;margin-bottom: 20px">
                <div class="cemydyz_xcjcbl_head">
                    <div class="cemydyz_xcjcbl_head_icon">
                    </div>
                    <div class="cemydyz_xcjcbl_head_title">
                        上次停電相關圖片
                    </div>
                </div>
                <div class="cemydyz_xcjcbl_content">
                    <div class="cem-no-data" ng-if="menus.length<1"></div>
                    <div class="cb-content-body hy-layout-row" style="flex-wrap: wrap">
                        <div class="hy-layout-row" style="width: 25%;" ng-repeat="item in menus track by $index">
                            <img ng-src="{{ item.src }}" style="width: 80px;height: 80px;"
                                 ng-click="showImg(item.src)"/>
                        </div>
                    </div>
                </div>
            </div>
            <!--結果信息-->
            <div style="width: 100%;margin-bottom: 20px">
                <div class="cemydyz_xcjcbl_head">
                    <div class="cemydyz_xcjcbl_head_icon">
                    </div>
                    <div class="cemydyz_xcjcbl_head_title">
                        結果信息
                    </div>
                </div>
                <div class="cemydyz_xcjcbl_content">
                    <div class="hy-layout-row">
                        <div class="hy-layout-row cemydzy-xcjc-form-row-header hy-layout-align-end-center cem-important-note">
                            復電結果
                        </div>
                        <div class="hy-layout-row cemydzy-xcjc-form-row-content cemydzy-border-bottom">
                            <hy-drop-list items="tdjgDrop" ng-model="jbxx.rcnntrsltcd" class="cem-form-list"
                                          hya-value-key="DMBM"
                                          hya-title-key="DMBMMC"
                                          hya-selected="failChange($value)"
                                          placeholder="請選擇">
                            </hy-drop-list>
                        </div>
                    </div>
                    <div class="hy-layout-row" ng-if="jbxx.rcnntrsltcd==='02'">
                        <div class="hy-layout-row cemydzy-xcjc-form-row-header hy-layout-align-end-center cem-line-height cem-important-note">
                            復電失敗原因
                        </div>
                        <div class="hy-layout-row cemydzy-xcjc-form-row-content cemydzy-border-bottom">
                            <hy-drop-list items="sbyyDrop" ng-model="jbxx.rcnntfailrsncd" class="cem-form-list"
                                          hya-value-key="DMBM"
                                          hya-title-key="DMBMMC"
                                          placeholder="請選擇">
                            </hy-drop-list>
                        </div>
                    </div>
                    <div class="hy-layout-row">
                        <div class="hy-layout-row cemydzy-xcjc-form-row-header hy-layout-align-end-center"
                             style="line-height: normal">電錶號
                        </div>
                        <div class="hy-layout-row cemydzy-xcjc-form-row-content cemydzy-border-bottom">
                            <input ng-model="jbxx.asseno" placeholder="請輸入" hy-focus-scroll
                                   class="cem-form-input"/>
                            <div class="cem-input-scancode" ng-click="scanMeter()">
                                <img src="img/cem/cbbl/scancode.png"/>
                            </div>
                        </div>
                    </div>
                    <div class="hy-layout-row">
                        <div class="hy-layout-row cemydzy-xcjc-form-row-header hy-layout-align-end-center"
                             style="line-height: normal">電錶讀數
                        </div>
                        <div class="hy-layout-row cemydzy-xcjc-form-row-content cemydzy-border-bottom">
                            <input ng-model="jbxx.currread" placeholder="請輸入" ng-blur="testRead()" hy-focus-scroll
                                   class="cem-form-input"/>
                        </div>
                    </div>
                    <div class="hy-layout-column">
                        <div class="hy-layout-row cemydzy-xcjc-form-row-header hy-layout-align-end-center">現場備註</div>
                        <div class="hy-layout-row" style="margin: 0 20px;">
                            <textarea class="cem-form-textarea" hy-focus-scroll
                                      style="background-color: #FFF9e9;padding: 10px;border: none;"
                                      placeholder="請輸入" rows="4" ng-model="jbxx.rmk"></textarea>
                        </div>
                    </div>
                </div>
            </div>
            <!--拍照上傳-->
            <div style="width: 100%;margin-bottom: 20px">
                <div class="cemydyz_xcjcbl_head">
                    <div class="cemydyz_xcjcbl_head_icon">
                    </div>
                    <div class="cemydyz_xcjcbl_head_title">
                        拍照上傳
                    </div>
                </div>
                <div class="cemydyz_xcjcbl_content">
                    <div class="cb-content-body">
                        <div class="cb-content-body">
                            <div class="hy-file-list">
                                <hy-image-list class="app-select-image" height="80" style="width: 100%;"
                                               hya-list="photoList" hya-column="4"
                                               hya-add="selectPicture($callback);"
                                               hya-delete="deletePhoto($index,$item,$done);"
                                               hya-item-del="canDelFile($item)"
                                               hya-src-key="SRC">
                                    <img ng-src="{{item.SRC}}" class="cem_pzsc_img"/>
                                </hy-image-list>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!--鎖號-->
        <div style="overflow: scroll" class="hy-focus-scroll-content" ng-if="SortType===1">
            <!--新增鎖號列表-->
            <div style="width: 100%;">
                <div class="cemydyz_xcjcbl_head">
                    <div class="cemydyz_xcjcbl_head_icon">
                    </div>
                    <div class="cemydyz_xcjcbl_head_title">
                        新增鎖號列表
                    </div>
                    <div class="cem-input-scancodes" ng-click="addNewLock('fd')"
                         style="margin:8px 10px;width: 20px;height: 20px">
                        <img src="img/cem/ydzybl/cem_add.png"/>
                    </div>
                </div>
                <div class="cem-query-result cem-sxx-tab">
                    <div class="cem-no-data" ng-if="xzsList.length<=0 && xzsRList.length<=0"></div>
                    <!--新装鎖號列表-->
                    <div class="cem-query-result-item" ng-repeat="item in xzsList track by $index"
                         ng-if="xzsList.length>0">
                        <div class="hy-layout-row hy-layout-align-end-center">
                            <img style="margin-bottom: 7px;height: 18px" src="img/cem/cbbl/shandiao.png"
                                 ng-click="delXzsh($index)"/>
                        </div>
                        <div class="hy-layout-row">
                            <div class="hy-layout-row cem-result-form-header40"
                                 ng-class="{'cem-important-note':!item.saveBz}">鎖編號
                            </div>
                            <div class="hy-layout-row cem-result-form-content cemydzy-border-bottom"
                                 ng-if="!item.saveBz" style="flex: 1;">
                                <input ng-model="item.sealno" placeholder="請輸入" hy-focus-scroll
                                       class="cem-form-input"/>
                                <div class="cem-input-scancode" ng-click="scanLock(item)">
                                    <img src="img/cem/cbbl/scancode.png"/>
                                </div>
                            </div>
                            <div class="hy-layout-row cem-result-form-content" ng-if="item.saveBz">
                                <div class="hy-layout-row cem-result-form-content">
                                    {{ item.sealno }}
                                </div>
                            </div>
                        </div>
                        <div class="hy-layout-row">
                            <div class="hy-layout-row cem-result-form-header40">加封對象</div>
                            <div class="hy-layout-row cem-result-form-content"
                                 ng-class="{'cemydzy-border-bottom':!item.saveBz}">
                                <hy-drop-list items="jfsbDrop" ng-model="item.sealequicate" class="cem-form-list"
                                              ng-show="!item.saveBz"
                                              hya-value-key="DMBM"
                                              hya-title-key="DMBMMC"
                                              placeholder="請選擇">
                                </hy-drop-list>
                                <div hya-drop-lable="item.sealequicate" hya-drop-lable-dmfl="SEALEQUICATECD"
                                     ng-if="item.saveBz"></div>
                            </div>
                        </div>
                        <div class="hy-layout-row">
                            <div class="hy-layout-row cem-result-form-header40">資產編號</div>
                            <div class="hy-layout-row cem-result-form-content cemydzy-border-bottom"
                                 ng-if="!item.saveBz">
                                <input ng-model="item.sealasseno" placeholder="請輸入" hy-focus-scroll
                                       class="cem-form-input"/>
                                <div class="cem-input-scancode" ng-click="scanZcbh(item)">
                                    <img src="img/cem/cbbl/scancode.png"/>
                                </div>
                            </div>
                            <div class="hy-layout-row cem-result-form-content" ng-if="item.saveBz">
                                <div class="hy-layout-row cem-result-form-content">
                                    {{ item.sealasseno }}
                                </div>
                            </div>
                        </div>
                    </div>
                    <!--原新装鎖號列表   接口返回-->
                    <div class="cem-query-result-item" ng-repeat="item in xzsRList track by $index"
                         ng-if="xzsRList.length>0">
                        <div class="cem-query-lsjd-title">
                            <div>
                                <div>鎖編號</div>
                                <div style="font-size: 21px;color: #ffc72c;">{{ item.sealno }}</div>
                            </div>
                            <div ng-click="delXzshR($index)">
                                <img style="margin-top: 5px" src="img/cem/cbbl/shandiao.png"/>
                            </div>
                        </div>
                        <div class="hy-layout-row">
                            <div class="hy-layout-row cem-result-form-header">加封對象</div>
                            <div class="hy-layout-row cem-result-form-content">
                                {{ item.sealassemeteequiuniqidMc }}
                            </div>
                        </div>
                        <div class="hy-layout-row">
                            <div class="hy-layout-row cem-result-form-header">資產編號</div>
                            <div class="hy-layout-row cem-result-form-content">
                                {{ item.sealasseno }}
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!--拆除鎖號列表-->
            <div style="width: 100%;margin-bottom: 20px">
                <div class="cemydyz_xcjcbl_head">
                    <div class="cemydyz_xcjcbl_head_icon">
                    </div>
                    <div class="cemydyz_xcjcbl_head_title">
                        拆除鎖號列表
                    </div>
                    <div class="cem-input-scancodes" ng-click="addDelLock('fd')"
                         style="margin:8px 10px;width: 20px;height: 20px">
                        <img src="img/cem/ydzybl/cem_add.png"/>
                    </div>
                </div>
                <div class="cem-query-result cem-sxx-tab">
                    <div class="cem-no-data" ng-if="ccsList.length<=0 && ccsRList.length<=0"></div>
                    <!--新增 拆除鎖號列表-->
                    <div class="cem-query-result-item" ng-repeat="item in ccsList track by $index"
                         ng-if="ccsList.length>0">
                        <div class="hy-layout-row hy-layout-align-end-center">
                            <img style="margin-bottom: 7px;height: 18px" src="img/cem/cbbl/shandiao.png"
                                 ng-click="delCcsh($index)"/>
                        </div>
                        <div class="hy-layout-row">
                            <div class="hy-layout-row cem-result-form-header40"
                                 ng-class="{'cem-important-note':!item.saveBz}">鎖編號
                            </div>
                            <div class="hy-layout-row cem-result-form-content cemydzy-border-bottom"
                                 ng-if="!item.saveBz" style="flex: 1;">
                                <input ng-model="item.sealno" placeholder="請輸入" hy-focus-scroll
                                       class="cem-form-input"/>
                                <div class="cem-input-scancode" ng-click="scanLock(item)">
                                    <img src="img/cem/cbbl/scancode.png"/>
                                </div>
                            </div>
                            <div class="hy-layout-row cem-result-form-content" ng-if="item.saveBz">
                                <div class="hy-layout-row cem-result-form-content">
                                    {{ item.sealno }}
                                </div>
                            </div>
                        </div>
                    </div>
                    <!--原拆除鎖號列表 接口返回-->
                    <div class="cem-query-result-item" ng-repeat="item in ccsRList track by $index"
                         ng-if="ccsRList.length>0">
                        <div class="cem-query-lsjd-title">
                            <div>
                                <div>鎖編號</div>
                                <div style="font-size: 21px;color: #ffc72c;">{{ item.sealno }}</div>
                            </div>
                            <div ng-click="delCcsR($index)">
                                <img style="margin-top: 5px" src="img/cem/cbbl/shandiao.png"/>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <ons-bottom-toolbar class="cem-button" ng-if="orderType!=='2'">
        <div style="width: 33%" class="button-solid" ng-click="saveTdxx()">保存</div>
        <div style="width: 33%" class="button-solid" ng-click="send()">傳遞</div>
    </ons-bottom-toolbar>
    <ons-bottom-toolbar class="cem-button" ng-if="orderType==='2'">
        <div style="width: 60%" class="button-solid" ng-click="savePhoto()">照片上傳</div>
    </ons-bottom-toolbar>
</ons-page>
